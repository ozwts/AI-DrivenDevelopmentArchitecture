/users:
  get:
    tags:
      - users
    summary: ユーザーのリストを取得
    security:
      - CognitoAuthorizer: []
    responses:
      "200":
        description: ユーザーリスト取得に成功
        content:
          application/json:
            schema:
              $ref: "user.schemas.yaml#/UsersResponse"
      "401":
        description: 認証エラー
        content:
          application/json:
            schema:
              $ref: "../shared/error.schemas.yaml#/ErrorResponse"
      "500":
        description: サーバーエラー
        content:
          application/json:
            schema:
              $ref: "../shared/error.schemas.yaml#/ErrorResponse"

/users/me:
  get:
    tags:
      - users
    summary: 現在のユーザーの詳細を取得
    description: 認証トークンから現在のユーザー情報を取得する
    security:
      - CognitoAuthorizer: []
    responses:
      "200":
        description: ユーザー詳細取得に成功
        content:
          application/json:
            schema:
              $ref: "user.schemas.yaml#/UserResponse"
      "401":
        description: 認証エラー
        content:
          application/json:
            schema:
              $ref: "../shared/error.schemas.yaml#/ErrorResponse"
      "404":
        description: ユーザーが存在しない
        content:
          application/json:
            schema:
              $ref: "../shared/error.schemas.yaml#/ErrorResponse"
      "500":
        description: サーバーエラー
        content:
          application/json:
            schema:
              $ref: "../shared/error.schemas.yaml#/ErrorResponse"
  post:
    tags:
      - users
    summary: 現在のユーザーを登録
    description: Cognito認証後の初回ログイン時にユーザー情報をDBに同期する。認証トークンからsub/email/emailVerifiedを取得する。
    security:
      - CognitoAuthorizer: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "user.schemas.yaml#/RegisterUserParams"
    responses:
      "201":
        description: ユーザー登録に成功
        content:
          application/json:
            schema:
              $ref: "user.schemas.yaml#/UserResponse"
      "400":
        description: バリデーションエラー
        content:
          application/json:
            schema:
              $ref: "../shared/error.schemas.yaml#/ErrorResponse"
      "401":
        description: 認証エラー
        content:
          application/json:
            schema:
              $ref: "../shared/error.schemas.yaml#/ErrorResponse"
      "422":
        description: ドメインルールエラー
        content:
          application/json:
            schema:
              $ref: "../shared/error.schemas.yaml#/ErrorResponse"
      "500":
        description: サーバーエラー
        content:
          application/json:
            schema:
              $ref: "../shared/error.schemas.yaml#/ErrorResponse"
  patch:
    tags:
      - users
    summary: 現在のユーザー情報を更新
    description: 認証トークンから現在のユーザーを特定して情報を更新する
    security:
      - CognitoAuthorizer: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "user.schemas.yaml#/UpdateUserParams"
    responses:
      "200":
        description: ユーザー更新に成功
        content:
          application/json:
            schema:
              $ref: "user.schemas.yaml#/UserResponse"
      "400":
        description: バリデーションエラー
        content:
          application/json:
            schema:
              $ref: "../shared/error.schemas.yaml#/ErrorResponse"
      "401":
        description: 認証エラー
        content:
          application/json:
            schema:
              $ref: "../shared/error.schemas.yaml#/ErrorResponse"
      "403":
        description: アクセス拒否、権限エラー
        content:
          application/json:
            schema:
              $ref: "../shared/error.schemas.yaml#/ErrorResponse"
      "404":
        description: ユーザーが存在しない
        content:
          application/json:
            schema:
              $ref: "../shared/error.schemas.yaml#/ErrorResponse"
      "422":
        description: ドメインルールエラー
        content:
          application/json:
            schema:
              $ref: "../shared/error.schemas.yaml#/ErrorResponse"
      "500":
        description: サーバーエラー
        content:
          application/json:
            schema:
              $ref: "../shared/error.schemas.yaml#/ErrorResponse"
  delete:
    tags:
      - users
    summary: 現在のユーザーを削除
    description: 認証トークンから現在のユーザーを特定して削除する。ユーザーは自分自身のアカウントのみ削除可能。
    security:
      - CognitoAuthorizer: []
    responses:
      "204":
        description: ユーザー削除に成功
      "401":
        description: 認証エラー
        content:
          application/json:
            schema:
              $ref: "../shared/error.schemas.yaml#/ErrorResponse"
      "403":
        description: アクセス拒否、権限エラー
        content:
          application/json:
            schema:
              $ref: "../shared/error.schemas.yaml#/ErrorResponse"
      "404":
        description: ユーザーが存在しない
        content:
          application/json:
            schema:
              $ref: "../shared/error.schemas.yaml#/ErrorResponse"
      "500":
        description: サーバーエラー
        content:
          application/json:
            schema:
              $ref: "../shared/error.schemas.yaml#/ErrorResponse"

/users/{userId}:
  get:
    tags:
      - users
    summary: ユーザーの詳細を取得
    security:
      - CognitoAuthorizer: []
    parameters:
      - name: userId
        in: path
        required: true
        schema:
          type: string
        description: ユーザーID
    responses:
      "200":
        description: ユーザー詳細取得に成功
        content:
          application/json:
            schema:
              $ref: "user.schemas.yaml#/UserResponse"
      "401":
        description: 認証エラー
        content:
          application/json:
            schema:
              $ref: "../shared/error.schemas.yaml#/ErrorResponse"
      "404":
        description: ユーザーが存在しない
        content:
          application/json:
            schema:
              $ref: "../shared/error.schemas.yaml#/ErrorResponse"
      "500":
        description: サーバーエラー
        content:
          application/json:
            schema:
              $ref: "../shared/error.schemas.yaml#/ErrorResponse"
