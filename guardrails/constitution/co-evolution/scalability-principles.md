# スケーラビリティの原則

## 最高原則

**成長を前提として設計する。** システムは成長する。ユーザー数、データ量、機能、複雑性。この成長に対して、コストが線形以下で対応できる構造を維持する。

---

## スケーラビリティの本質

**スケーラビリティとは、成長がシステムを破綻させない性質である。**

| 成長の軸 | 破綻の兆候 |
|---------|-----------|
| データ量 | 応答時間の劣化、処理の失敗 |
| 負荷 | リソース枯渇、サービス停止 |
| 機能 | 複雑性の爆発、変更不能 |

**本質的な問い**: 今の10倍、100倍になったとき、システムは機能し続けるか？

---

## 4つの原則

### 原則1: 比例を避ける

**処理コストがデータ量に比例してはならない。**

- 件数が増えても、処理回数は増えない設計
- 全体を扱わず、必要な部分のみを扱う
- 量の増加を吸収する仕組みを持つ

**本質**: 1件の処理と1000件の処理で、根本的なアプローチが変わらないこと。

### 原則2: 状態を分離する

**処理と状態を分離し、処理能力を水平に拡張可能にする。**

- 状態を処理から切り離し、外部に委譲
- 任意の処理ノードが同等に機能
- 特定のノードへの依存を排除

**本質**: 処理能力の追加が、設計の変更なく可能であること。

### 原則3: 有限を受容する

**無制限を許容せず、あらゆるリソースに上限を設ける。**

- 入力、出力、時間、同時実行に境界を設定
- 境界を超えた場合の振る舞いを明示
- リソースの枯渇を構造的に防止

**本質**: システムは有限のリソースで動作する。その有限性を設計に組み込むこと。

### 原則4: 計測で判断する

**推測ではなく、計測に基づいて最適化する。**

- 早すぎる最適化を避け、まず動くものを作る
- ボトルネックを計測で特定し、必要な箇所のみを改善
- 成長特性を予測し、破綻点を事前に把握する

**本質**: 最適化は投資である。計測なき最適化は、効果のない場所への投資である。

---

## 効率の追求

### 再利用

同じ計算を繰り返さない。同じデータを何度も取得しない。一度得た結果を適切に保持し、再利用する。

### 集約

個別の処理を集約し、一度に実行する。通信、変換、永続化のオーバーヘッドを最小化する。

---

## 優先順位

**スケーラビリティはユーザー体験を持続的に提供するための手段である。**

ユーザー体験を損なう効率化は本末転倒である（`../user-first/user-first-principles.md`参照）。

| 衝突 | 判断 |
|------|------|
| 即時性 vs 効率 | ユーザー体験を優先 |
| 可読性 vs 効率 | まず可読性、計測後に最適化 |
