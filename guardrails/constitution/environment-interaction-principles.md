# 環境干渉原則

## 最高原則

AIのシステムへの干渉は**環境により厳格に制御（Environment-Controlled）**されなければならない。

- **ローカルテストによる高速イテレーション**: ローカル環境でテストを通じて即座に干渉結果を検証し、最速のフィードバックループを実現
- **開発環境でのスクラップアンドビルド**: 開発環境（クラウド）で開発に必要な全ての手続きを制限なく実施可能、環境の作り直しが自由
- **多層防御による干渉防止**: 検証・本番環境へのアクセスを複数の技術的レイヤーで防止し、物理的にアクセス不可能にする

## 理念

### 環境干渉の本質

環境干渉とは、**環境による厳格な制御**の下で、**ローカルテスト**により**AIが最速で世界へ干渉**し、**自律的にイテレーション**することである。

**ローカルテストが可能にするもの**:

- AIが実装した変更を**ローカルで数秒で検証**し、成功・失敗を即座にフィードバック
- テスト失敗をAIが自律的に検知・修正し、**人間や本番環境への影響なしに**イテレーションを継続
- 実験的な変更を**ローカルで迅速に試行**し、テストで安全性を保証してから上位環境へ移行

**環境の階層**:

- **ローカル環境**: AIが**ユニットテストを通じて即座に干渉結果を検証**でき、最速のイテレーションが可能
- **開発環境**: クラウド上の開発環境。**スクラップアンドビルド可能**で、AIが制限なく干渉・実験可能。**E2Eテストによる統合検証**が可能
- **検証環境**: 本番と同等の環境。開発環境で全テスト成功後、人間の承認を経てデプロイ
- **本番環境**: 実際のユーザーが利用する環境。多層防御でAIの直接干渉を物理的に防止

### 得られるベネフィット

**開発速度の最大化**:

- **ローカルテスト**がAIの干渉結果を数秒で検証し、最速のフィードバックループを実現
- **開発環境のスクラップアンドビルド**により、失敗を恐れずに実験的な変更を試行可能
- テスト失敗を**ローカルで即座に検知**し、AIが自律的に修正して開発を継続

**AIの自律的な問題解決**:

- **ローカルのユニットテスト**がAIに「何が壊れているか」を明示し、人間の介入なしに修正可能
- **開発環境でのE2Eテスト**により、システム全体の統合動作を検証し、コンポーネント間の問題を早期発見
- **開発環境での自由な実験**により、複数の実装パターンを試行し最適な解を自律的に選択

**本番環境の安全性確保**:

- **ローカル・開発環境でのテスト**により問題を早期発見し、本番への波及を防止
- **検証環境で本番と同等の条件**で最終確認し、ユーザーへの影響をゼロに
- 多層防御により検証・本番環境への直接干渉を技術的に防止

## 制度：三権分立による実現

### Policy（立法）

環境別の干渉ルールを定義する。

#### テスト駆動の原則

**ユニットテストの必須化**: 全ての変更に対してローカル環境でユニットテストを実行し、成功を確認してから次のステップへ進む

**ローカルでの即座のフィードバック**: ローカル環境でのユニットテスト実行を自動化し、AIが変更後数秒で結果を得られる状態を維持

**開発環境でのE2E検証**: 開発環境でE2Eテストを実行し、システム全体の統合動作を検証

**品質ゲート**: ローカル環境でのユニットテスト・開発環境でのE2Eテスト全成功を検証・本番環境への移行の必須条件とする

#### 環境分離の原則

**ローカル環境**: 開発者のマシン。AIがテストを通じて即座に干渉結果を検証でき、最速のイテレーションが可能

**開発環境**: クラウド上の開発環境。AIが制限なく干渉可能、スクラップアンドビルド可能

**検証環境**: 本番と同等の環境。AIの直接干渉を禁止、人間の承認後にCI/CDでデプロイ

**本番環境**: 実際のユーザーが利用する環境。AIの直接干渉を物理的に禁止

#### MCPツールによる干渉の原則

**ローカル・開発環境専用のツール**: MCPサーバーにはローカル・開発環境にのみアクセス可能なツールを実装し、検証・本番環境へのアクセス手段を提供しない

**統一されたインターフェース**: 全ての環境操作はMCPツールを通じて実行し、統制された方法でシステムを操作

#### ローカル・開発環境での許可事項

開発に必要な全ての操作（コード変更、テスト、ビルド、デプロイ、インフラ変更、パッケージ更新、環境の作り直し等）を制限なく実施可能

#### 検証・本番環境での禁止事項

コード変更・デプロイ・データベース操作・インフラ設定変更・ユーザーデータアクセス等、全ての直接的な干渉を禁止

#### 多層防御の原則

**MCPツールレイヤー**: MCPサーバーには検証・本番環境へのアクセス手段を実装せず、ローカル・開発環境専用のツールのみを提供

**認証・認可**: IAM・権限管理で検証・本番環境へのアクセス権限を付与しない

**環境分離**: アカウント自体を分離し検証・本番環境への通信経路を遮断

**単一障害点の排除**: 一つの防御が破られても、他のレイヤーで防止

### Procedure（行政）

環境干渉を実装し、**ローカルテストによりAIの自律開発を最大加速**しつつ、**本番環境の安全性を担保**する。

#### ローカルテスト駆動の実装

**自動テスト実行**: コード変更後、AIが**ローカル環境で**自動的にテストを実行し、結果を即座に取得

**失敗時の自律修正**: **ローカルテスト**の失敗をAIが検知し、エラーメッセージから原因を特定して自律的に修正

**継続的なフィードバック**: **ローカル環境で**テスト→修正→テストのサイクルを人間の介入なしに高速で回す

#### 開発環境でのスクラップアンドビルドとE2E検証

**環境の自由な作り直し**: 開発環境（クラウド）をAIが必要に応じてスクラップアンドビルド可能にし、失敗を恐れない実験を促進

**E2Eテストの実行**: 開発環境でAIがE2Eテストを実行し、システム全体の統合動作を検証

**インフラ変更の自由**: 開発環境ではAIが自由にインフラ構成を変更・実験可能

#### MCPサーバーの設計

MCPサーバーにはローカル・開発環境にのみアクセス可能なツールを実装し、検証・本番環境へのアクセス手段を一切提供しない

#### 検証・本番環境への移行制御

**テストによる品質ゲート**: ローカル・開発環境での全テストが成功しない限り、検証・本番環境への移行を物理的にブロック

**人間の承認**: テスト成功後、検証・本番環境へのデプロイは人間がPR承認・マージを通じて実施

**自動デプロイ**: 承認後はCI/CDパイプラインが自動的にデプロイを実行

### Review（司法）

環境干渉の適切性を審査する。

#### 審査項目

**テスト実行の確認**:

- ローカル環境での変更に対して適切なユニットテストが実行されているか
- **ローカルテスト**が失敗した場合、AIが自律的に修正を試みているか
- 開発環境でE2Eテストが実行されているか
- 検証・本番環境への移行前にローカル・開発環境で全テスト（ユニットテスト・E2Eテスト）が成功しているか

**環境の適切な利用**:

- 開発環境がスクラップアンドビルド可能な状態に保たれているか
- 検証環境が本番と同等の構成になっているか

**MCPツールの設計審査**:

- MCPサーバーに検証・本番環境へのアクセス手段が実装されていないか
- ローカル・開発環境専用のツールのみが提供されているか

**環境境界の遵守**:

- AIがローカル・開発環境でのみ操作しているか
- 検証・本番環境への直接干渉が発生していないか

#### 実施方法

**自動レビュー**: テスト実行の必須化、テスト失敗時のブロック、不正アクセス試行を検知・ブロック

**手動レビュー**: PRレビュー時にテスト結果と本番環境への影響を評価してからマージ承認

## 原則の適用

### テスト駆動の実践

**ローカル環境**で全ての変更に対してユニットテストを実行し、AIが結果を即座に取得できる環境を構築。テスト失敗を**ローカルで検知**し、自律的に修正するサイクルを確立。

**開発環境**でE2Eテストを実行し、システム全体の統合動作を検証。コンポーネント間の問題を早期発見。

### 環境の明確な定義

**ローカル環境**: 開発者のマシン。AIが**ユニットテストを通じて即座に干渉結果を検証**でき、**最速のイテレーション**が可能

**開発環境**: クラウド上の開発環境。**スクラップアンドビルド可能**で、AIが制限なく干渉・実験可能。**E2Eテストによる統合検証**が可能

**検証環境**: **本番と同等**の環境。ローカル・開発環境で全テスト（ユニットテスト・E2Eテスト）成功後、人間の承認を経てCI/CDによりデプロイ

**本番環境**: 実際のユーザーが利用する環境。ローカル・開発環境で全テスト（ユニットテスト・E2Eテスト）成功後、人間の承認を経てCI/CDによりデプロイ
