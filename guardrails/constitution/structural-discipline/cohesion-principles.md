# 凝集の原則

## 最高原則

**凝集により変更を1箇所に集約する。** 「カテゴリが同じ」ではなく「目的が同じ」要素を一つの場所にまとめ、変更が1箇所で完結するようにする。

---

## 機能的凝集の本質

モジュール内のすべての要素が**単一の明確な目的**のために連携している状態。

**得られるベネフィット**:
- 機能の変更が1つのディレクトリ内で完結する
- 機能の削除がディレクトリの削除で完結する
- 変更箇所がディレクトリ構造から特定できる

---

## 論理的凝集（アンチパターン）

**定義**: 関連性の低い要素が「カテゴリが同じ」という理由だけでまとめられた状態。

**問題点**:
- 条件分岐がコード全体に散らばる
- 一つの変更が予期せぬ箇所に影響する
- 「UIがほぼ同じ」という初期判断が技術的負債となる

---

## 核心原則

### 原則1: ディレクトリ = 機能境界

ディレクトリ構造を機能境界として活用する。関連ファイルはすべて同じディレクトリに配置し、データフローがディレクトリ内で完結するようにする。

### 原則2: 構造的分離

異なるユーザーロールやコンテキストは、UIが似ていても**条件分岐ではなくディレクトリ構造で分離**する。

### 原則3: 共通化の判断基準（3回ルール）

「似ている」と感じても、すぐに共通化しない。

| 問い | 基準 |
|------|------|
| いつ（WHEN） | 3つ以上の箇所で利用されるまで待つ |
| 何を（WHAT） | 意味的に同一のもののみ共通化 |
| どこに（WHERE） | 最も近い共通の親に配置 |

### 原則4: 分割できない場合

単一モジュール内で多様な要素を扱う場合は、パターンマッチ等で各ケースの処理を分離し、網羅性を保証する。

---

## boundaryとの関係

| 原則 | 焦点 | 問い | 効果 |
|------|------|------|------|
| **boundary** | 分離 | 何を分けるか？ | 変更が波及しない |
| **cohesion** | 凝集 | 何をまとめるか？ | 変更が1箇所で済む |

分離と凝集は対になる概念。分離なき凝集は混沌、凝集なき分離は断片化を招く（`./boundary-principles.md`参照）。
