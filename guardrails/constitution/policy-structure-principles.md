# ポリシー構造の原則

## 最高原則

ポリシーは**段階的理解と機械的検証**を可能にする構造でなければならない。概要から詳細へ段階的に情報を提供し、AIエージェントと人間の両方が効率的に理解・適用できる形式とする。

## 階層構造の原則

### 原則1: X0-{topic}-overview.md（概要ファイル）

**必須セクション**:
1. **核心原則**: この領域の最も重要な原則を1-2文で表現
2. **責務**: 「実施すること/実施しないこと」を明示（MECE原則）
3. **Do/Don't**: 良い例・悪い例を具体的なコードで提示
4. **チェックリスト**: 機械的に検証可能な項目（Yes/Noで判断できる）

**例**:
```markdown
## 実施すること
1. **データ永続化**: DBへの読み書き、トランザクション管理
2. **データ変換**: ドメインモデル ⇔ DB形式の変換

## 実施しないこと
1. **ビジネスルール** → UseCase層で実施
2. **バリデーション** → Domain層で実施

## Do / Don't

### ✅ Good
（具体的なコード例）

### ❌ Bad
（具体的なコード例と理由）
```

### 原則2: X1-X9-{topic}-{detail}.md（詳細ファイル）

**必須セクション**: 概要、関連ドキュメント、実装パターン、Do/Don't、チェックリスト

### 原則3: ファイル番号体系と命名規則

**番号体系**:
```
10番台: 領域全体の概要と横断的原則
  - 10: 領域全体の概要
  - 11-19: 横断的詳細

20番台以降: トピック別（10番台刻み）
  - X0: トピック概要
  - X1-X9: トピック詳細
```

**命名規則**:
- 概要: `X0-{topic}-overview.md`（必ず`-overview`サフィックス）
- 詳細: `X1-{topic}-{detail}.md`（具体的な内容名）

## 内容粒度の原則

### 原則4: 核心原則は1-2文で表現

AIエージェントが本質を即座に把握できる必要がある。

### 原則5: 責務は「実施/非実施」で明確化（MECE原則）

非実施には必ず代替実施場所を明記する。

### 原則6: Do/Don'tは必ずコード例を含める

抽象的な説明よりも、具体的なコード例が理解を促進する。

### 原則7: チェックリストは機械的検証可能な項目のみ

```markdown
✅ Good: from()メソッドはpropsパターンを使用している
❌ Bad: 適切に実装されている（主観的で検証不可）
```

## 思想原則

### 原則8: MECE原則（相互排他的かつ網羅的）

- 責務分離: 各層・コンポーネントの責務が重複せず、漏れがない
- バリデーション階層: 型レベル、ドメインルール、ビジネスルールが重複しない
- ポリシーファイル: 同じ内容が複数ファイルに記載されない

### 原則9: Single Source of Truth

すべての情報は唯一の情報源から派生する。

```
OpenAPI仕様（唯一の情報源） → Zodスキーマ → TypeScript型定義
```

**禁止**: 手動型定義作成、バリデーションルール重複、コメントによる型制約説明

### 原則10: Always Valid Domain Model

ドメインオブジェクトは作成時点から常に正しい状態である。不正な状態を許容しない。

### 原則11: 解析可能性の最大化

変更の影響範囲を静的に追跡可能にする。型システムで表現可能なことは型で表現する。

**参照**: `constitution/analyzability-principles.md`

## AIエージェント読み込み戦略

### 原則12: 段階的読み込み

**Step 1**: 概要ファイル（`*0-*-overview.md`）のみ読み込み
**Step 2**: 違反検出時に詳細ファイルを参照

**メリット**: トークン消費最小化、レイテンシ削減

### 原則13: 相互参照の明記

```markdown
**関連ドキュメント**:
- **Entity設計**: `20-entity-overview.md`
- **憲法**: `constitution/validation-principles.md`
```

## チェックリスト

### 概要ファイル
```
[ ] 核心原則を1-2文で表現
[ ] 「実施/非実施」セクション（非実施は代替場所明記）
[ ] Do/Don'tに具体的コード例
[ ] 機械的検証可能なチェックリスト
```

### 詳細ファイル
```
[ ] 関連ドキュメント明記
[ ] 実装パターン複数提示
[ ] 概要ファイルとの重複回避
```

### 全般
```
[ ] MECE原則遵守（責務重複なし）
[ ] Single Source of Truth遵守
[ ] 解析可能性優先（型システムで表現）
[ ] 命名規則準拠（X0は-overview）
```
