# インフラ原則

## 最高原則

インフラは**コードで管理され再現可能（Reproducible）**でなければならない。

- **Infrastructure as Code**: インフラをコードで管理し、いつでも同じ環境を再現可能にする
- **開発環境の自由な実験**: 複数のAIが専用の開発環境を速やかに起動・停止でき、コンフリクトしない
- **コスト効率**: 時間課金リソースを極力避け従量課金を優先し、環境の起動・停止コストをゼロに
- **環境別の保護方針**: 開発環境は自由に作り直し可能、検証・本番環境は削除保護・バージョン固定で安全性を担保

## 理念

### Infrastructure as Codeの本質

Infrastructure as Codeとは、**コードで管理され再現可能**であることで、**開発環境での自由な実験**と**本番環境の安全性**を両立し、**複数AIの分散協調開発を可能**にすることである。

### 得られるベネフィット

**開発速度の線形スケール**: 複数のAIが専用の開発環境を並列起動し、コンフリクトなく並行開発。環境をいつでも作り直せるため、失敗を恐れず実験できる

**コスト最適化**: 従量課金リソースにより開発環境の起動・停止コストをゼロに。使用した分だけ課金され、環境を自由に作り直せる

**安全性の担保**: 開発環境は削除保護無効・バージョン固定なしで自由に実験し破壊的変更を早期検知。検証・本番環境は削除保護・バージョン固定で誤削除と破壊的変更を防止。リソースベース認証でクレデンシャル漏洩を最小化

## 制度：三権分立による実現

### Policy（立法）

#### Infrastructure as Codeの原則

**コードでの管理**: 全てのインフラリソースをIaCツールで管理し、手動操作を禁止

**再現可能性**: 環境を数分で起動・停止・再作成できる状態を維持

#### 分散協調開発の原則

**環境の独立性**: リソース名に環境識別子を含め、複数のAIが専用の開発環境をデプロイしてもコンフリクトしない

#### コスト効率の原則

**従量課金の優先**: 時間課金リソースを極力避け、従量課金リソースを優先。環境の起動・停止に伴うコストをゼロに

#### 認証認可の原則

**リソースベース認証**: アクセスキーを極力発行せず、リソースベースの認証認可を原則とする

**シークレット管理**: やむを得ずクレデンシャルを扱う場合、シークレット管理サービスで一元管理

#### 環境別の削除保護とバージョン固定

**開発環境**: 削除保護を常に無効化し、自由に作り直し可能に。バージョン固定せず、破壊的変更を早期検知

**検証・本番環境**: 削除保護を必須とし、誤削除を物理的に防止。バージョンを固定し、破壊的変更から保護

### Procedure（行政）

インフラを実装し、**複数AIの分散協調開発を可能**にしつつ、**コストを最適化**し、**安全性を担保**する。

インフラをコードで管理し、環境識別子を付与して複数環境のコンフリクトを回避。従量課金リソースで構成し、環境の起動・停止コストをゼロに。リソースベース認証でアクセス制御し、やむを得ないクレデンシャルはシークレット管理サービスで管理。開発環境では削除保護を無効化・バージョン固定せず破壊的変更を早期検知。検証・本番環境では削除保護を有効化・バージョン固定で破壊的変更から保護。

### Review（司法）

#### 審査項目

**IaCの遵守**: 全てのインフラリソースがIaCツールで管理され、環境識別子が適切に付与されているか

**コスト効率の遵守**: 時間課金リソースが使用されず、従量課金リソースが優先されているか

**認証認可の適切性**: アクセスキーが不要に発行されず、リソースベース認証が適用されているか

**削除保護とバージョン固定の適切性**: 開発環境で削除保護が無効化・バージョン固定なしになっているか、検証・本番環境で削除保護が有効化・バージョン固定されているか

#### 実施方法

**自動レビュー**: IaCツールで変更内容を事前確認、削除保護の設定を自動チェック

**手動レビュー**: PRレビュー時にインフラ変更の妥当性を確認、本番環境への影響を評価
