# ビジネス契約 - 全体概要

## 核心原則

ビジネス契約は**ユビキタス言語の唯一の源泉**であり、すべてのコードはここから導出する。契約にない概念をコードに導入しない。

## 関連ドキュメント

| トピック | ファイル |
|---------|---------|
| 用語集 | `20-glossary.md` |
| 定義 | `30-definition.md` |
| シナリオ | `40-scenario.md` |

## 責務

### 実施すること

1. **語彙の定義**: ドメイン全体で共有される用語を用語集で定義する
2. **概念の構造化**: 概念・属性・制約を定義ファイルで記述する
3. **振る舞いの記述**: 期待される動作をシナリオで定義する
4. **集約境界の明示**: 子エンティティは親の定義ファイルに併記する

### 実施しないこと

1. **技術的詳細** → 実装層（server/domain/model）で決定
2. **API設計** → API契約（contracts/api）で定義
3. **DB設計** → DB契約（contracts/db）で定義

## 構造

```
/contracts
  /business                      # ビジネス契約
    glossary.md                  # ビジネス用語集
    /{domain}                    # ドメイン単位（集約ルート名）
      definition.md              # 定義（概念・属性・制約・集約）
      /scenario                  # シナリオ（振る舞い）
        {scenario}.md
  /api                           # API契約
  /db                            # DB契約
```

## 3つの成果物と導出関係

| 成果物 | 内容 | 導出されるもの |
|--------|------|---------------|
| glossary | 語彙・命名 | クラス名・変数名・ファイル名 |
| definition | 概念・属性・制約・集約 | ドメインモデル・値オブジェクト・リポジトリ |
| scenario | 振る舞い・前提・結果 | ユースケース・ハンドラ |

## 整合性の確保

### 用語集との一致

定義・シナリオで使用するすべての用語は、用語集に存在しなければならない。

```markdown
// ✅ Good: 用語集に「プロジェクトメンバー」が存在
## 属性
- プロジェクトメンバー：プロジェクトに参加しているユーザー

// ❌ Bad: 用語集に「参加者」が存在しない
## 属性
- 参加者：プロジェクトに参加しているユーザー
```

### 定義とシナリオの一致

シナリオで操作する概念は、定義ファイルに存在しなければならない。

### コードとの一致

| 契約 | コード |
|------|--------|
| 用語集の英語名 | クラス名・ファイル名 |
| 定義の属性 | Entityのプロパティ |
| 定義の制約 | Value Objectのバリデーション |
| シナリオ | UseCaseの実装 |

## Do / Don't

### Do: ドメインディレクトリに集約を凝集させる

```
/contracts/business
  /project                       # 集約ルート
    definition.md                # Project + ProjectMember を併記
    /scenario
      create-project.md
      invite-member.md           # 子エンティティの操作も同じディレクトリ
      remove-member.md
```

### Don't: 子エンティティを別ディレクトリで定義する

```
/contracts/business
  /project
    definition.md                # Project のみ
  /project-member                # ❌ 子エンティティを別ディレクトリに
    definition.md
    /scenario
      invite-member.md
```

**理由**: 契約の構造がそのまま実装の構造に反映される。契約で分離すると、実装でも別集約・別リポジトリとして誤設計される。
