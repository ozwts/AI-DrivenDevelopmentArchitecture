# シナリオ（Scenario）ポリシー

## 核心原則

シナリオは**ユースケースの唯一の源泉**である。期待される振る舞いを定義し、UseCase・Handlerはここから導出する。

## 責務

### 実施すること

1. **振る舞いの定義**: ビジネス上の操作を「誰が・いつ・何を・どうなる」で記述する
2. **権限の明示**: 操作を実行できるアクターを明確にする
3. **例外の列挙**: エラーケースを網羅的に記述する

### 実施しないこと

1. **概念の定義** → 定義ファイル（`30-definition.md`参照）で記述
2. **技術的な実装詳細** → 実装層（server/use-case）で決定
3. **API設計** → API契約（contracts/api）で定義

## 配置

```
/contracts
  /business
    /{domain}                    # 集約ルート名
      /scenario
        {scenario-name}.md       # 1シナリオ1ファイル
```

## 記述形式

```markdown
# {シナリオ名}

## 目的

{ビジネス上の目的}

## 誰が

{権限・条件}

## いつ

{トリガー}

## 何を

{入力・対象}

## どうなる

{結果・状態変化}

## 例外

{エラーケース}
```

## レビュー観点

### 用語集との整合性

| 確認項目 | 判断基準 |
|---------|---------|
| シナリオ名 | 用語集の動詞・概念と一致するか |
| 「誰が」のアクター | 用語集に存在するか |
| 「何を」の操作対象 | 用語集に存在するか |
| 「どうなる」の状態 | 定義の属性・制約と一致するか |

### 定義との整合性

| 確認項目 | 判断基準 |
|---------|---------|
| 操作対象 | 定義ファイルに存在するか |
| 属性の参照 | 定義の属性と一致するか |
| 例外 | 定義の制約と対応しているか |

### 配置の妥当性

| 確認項目 | 判断基準 |
|---------|---------|
| ディレクトリ | 集約ルートのディレクトリに配置されているか |
| 子エンティティの操作 | 親のディレクトリに配置されているか |

## Do / Don't

### Do: 子エンティティの操作は親のディレクトリに配置する

```
/contracts/business
  /project
    /scenario
      create-project.md
      invite-member.md     ← ProjectMember の操作も project 配下
      remove-member.md     ← ProjectMember の操作も project 配下
      list-members.md      ← ProjectMember の操作も project 配下
```

### Don't: 子エンティティの操作を別ディレクトリに配置する

```
/contracts/business
  /project
    /scenario
      create-project.md
  /project-member            ← ❌ 子エンティティを別ディレクトリに
    /scenario
      invite-member.md
      remove-member.md
```

**理由**: 定義と同様、契約の構造がそのまま実装の構造に反映される。

### Do: 用語集の概念を使用する

```markdown
## 誰が

プロジェクトのオーナー       ← 用語集: 「プロジェクト」「オーナー」

## 何を

- プロジェクトID
- 招待するユーザーのメールアドレス

## どうなる

- 指定されたユーザーがプロジェクトメンバーとして追加される
                              ← 用語集: 「プロジェクトメンバー」
```

### Don't: 用語集にない概念を使用する

```markdown
// ❌ Bad: 用語集に「参加者」がない
## どうなる

- 指定されたユーザーが参加者として追加される

// ✅ Good: 用語集の「プロジェクトメンバー」を使用
## どうなる

- 指定されたユーザーがプロジェクトメンバーとして追加される
```

### Do: 例外を定義の制約と対応させる

```markdown
// 定義の制約:
// - 各プロジェクトには最低1人のオーナーが必要
// - オーナーのみがメンバーを招待・削除できる

// シナリオの例外:
## 例外

- オーナー以外は削除できない       ← 制約「オーナーのみが...」に対応
- オーナー自身は削除できない       ← 制約「最低1人のオーナーが必要」に対応
```

## 原則

| 原則 | 説明 |
|------|------|
| 用語集と一致 | シナリオ内の用語は用語集と完全に一致させる |
| 1シナリオ1ファイル | シナリオ単位で凝集させる |
| ビジネス視点 | 技術的な実装詳細は書かない |
| 権限を明示 | 誰が実行できるかを明確にする |
| 入出力を明示 | 何を渡して何が変わるかを明確にする |
| 親に集約 | 子エンティティの操作は親のディレクトリに配置する |
